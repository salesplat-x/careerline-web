#!/usr/bin/env sh
. "$(dirname "$0")/h"

# Get the current branch name
BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD)

# Skip validation for detached HEAD state
if [ "$BRANCH_NAME" = "HEAD" ]; then
  exit 0
fi

# Skip validation for main branches
if [ "$BRANCH_NAME" = "main" ] || [ "$BRANCH_NAME" = "master" ] || [ "$BRANCH_NAME" = "develop" ] || [ "$BRANCH_NAME" = "dev" ]; then
  exit 0
fi

# Conventional branch naming pattern: type/description
# Valid types: feat, fix, docs, style, refactor, perf, test, chore, ci, revert
PATTERN="^(feat|fix|docs|style|refactor|perf|test|chore|ci|revert)/[a-z0-9\-]+$"

if ! echo "$BRANCH_NAME" | grep -qE "$PATTERN"; then
  echo "‚ùå Branch name '$BRANCH_NAME' does not follow conventional naming style"
  echo ""
  echo "Valid branch naming format: type/description"
  echo "Valid types: feat, fix, docs, style, refactor, perf, test, chore, ci, revert"
  echo ""
  echo "Examples:"
  echo "  feat/user-authentication"
  echo "  fix/login-button-bug"
  echo "  docs/update-readme"
  echo ""
  exit 1
fi

exit 0
